

----
oc adm policy add-cluster-role-to-user cluster-admin system:serviceaccount:openshift-operators:local-storage-admin
----


----
Ensure that /mnt/local-storage/<your storage class name>
exists on your nodes.

In my case,
ssh core@master-x.ocp44.local
cd /mnt/local-storage
sudo mkdir marcsc
----

----
apiVersion: local.storage.openshift.io/v1
kind: LocalVolume
items:
- apiVersion: local.storage.openshift.io/v1
  kind: LocalVolume
  metadata:
    creationTimestamp: "2020-04-01T23:34:15Z"
    finalizers:
    - storage.openshift.com/local-volume-protection
    generation: 3
    name: example2
    namespace: openshift-operators
    resourceVersion: "3705475"
    selfLink: /apis/local.storage.openshift.io/v1/namespaces/openshift-operators/localvolumes/example2
    uid: e397bdb3-1e02-44da-8ba1-9804acfc82ec
  spec:
    logLevel: Normal
    managementState: Managed
    storageClassDevices:
    - devicePaths:
      - /dev/vda
      - /dev/vda4
      fsType: ext4
      storageClassName: marcsc
      volumeMode: Filesystem
----

----
Create a PVC using your storage class name
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: local-pvc-name
spec:
  accessModes:
  - ReadWriteOnce
  volumeMode: Filesystem
  resources:
    requests:
      storage: 100Gi
  storageClassName: marcsc
----


----
cat patchcapacity.yaml
spec:
  capacity:
    storage: 100Gi
----

----
for pv in $(oc get pv|awk '{print $1}' | grep pv | grep -v NAME); do oc patch pv $pv --patch "$(cat patchcapacity.yaml)"; done 
----


----
Issues with PVC stuck at "Terminating"
Solved as follows:
kubectl patch pvc local-pvc-name -p '{"metadata":{"finalizers":null}}'
kubectl patch pv local-pv-c8bb60de -p '{"metadata":{"finalizers":null}}'

By default, the finalizer value is set to 'protect' which will block the deletion.
More about finalizers here :
https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/#finalizer
----
